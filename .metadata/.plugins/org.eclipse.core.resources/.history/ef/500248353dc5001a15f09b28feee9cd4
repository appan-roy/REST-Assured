package countryInfoServices;

import static io.restassured.RestAssured.*;
import io.restassured.path.xml.XmlPath;
import io.restassured.response.Response;
import java.io.FileInputStream;
import org.apache.commons.io.IOUtils;
import org.testng.annotations.Test;

import groovy.xml.XmlSlurper;
import groovy.xml.slurpersupport.GPathResult;


public class ListCountries {

	static String projDir = System.getProperty("user.dir");
	
	static String xmlPath = projDir+"/SOAP XML Files/ListCountries.xml";
	
	@Test
	public void getCountries() throws Exception {
		
		FileInputStream fis = new FileInputStream(xmlPath);
		
		baseURI = "http://webservices.oorsprong.org/websamples.countryinfo/CountryInfoService.wso?WSDL";
		
		Response res =
				
				given()
					.header("Content-Type", "text/xml")
					.and()
					.body(IOUtils.toString(fis, "UTF-8")).
				when()
					.post().
				then()
					.statusCode(200)
					.log().all()
					.extract().response();
		
//		XmlPath xml = new XmlPath(res.asString());
		
		GPathResult dataValue = new XmlSlurper().parseText(res.asString());
		
		String countryName = dataValue.ListOfCountryNamesByNameResult.tCountryCodeAndName[i].sName.text();
		
//		XmlPath xml = new XmlPath(res.asString());
//		
//		String country = xml.getString("tCountryCodeAndName");
//		
//		String countryISOCode = (String) country.subSequence(0, 2);
//		
//		System.out.println("The country ISO code is "+countryISOCode);
//		
//		String countryName = country.substring(2);
//		
//		System.out.println("The country name is "+countryName);
		
	}

}
